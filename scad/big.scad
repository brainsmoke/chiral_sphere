
r = 568.9023130792767;
w = 40.0;
subdivisions = 3;
thickness = 3.0;
top_space = 19.0;
bottom_space = 15.0;
h = 3*thickness+top_space+bottom_space;




module subdiv_arc(a, n)
{
    if (n > 0)
        rotate([0,0,a])
        {
            children();
            subdiv_arc(a,n-1)children();
        }
}

module joint()
{
    translate([r-thickness,0,0])
    rotate([0,90,0])
    rotate([0,0,90-A])
    top_joint();

    translate([r-2*thickness-top_space,0,0])
    rotate([0,90,0])
    rotate([0,0,90-A])
    mid_joint();

    translate([r-h+thickness,0,0])
    rotate([0,-90,0])
    rotate([0,0,A-90])
    bottom_joint();
}

module subdiv()
{
    translate([r-thickness,0,0])
    rotate([0,90,0])
    rotate([0,0,90])
    top_div();

    translate([r-2*thickness-top_space,0,0])
    rotate([0,90,0])
    rotate([0,0,90])
    mid_div();

    translate([r-h+thickness,0,0])
    rotate([0,-90,0])
    rotate([0,0,-90])
    bottom_div();
}

module big_side()
{
    translate([r-h,(w/2)*(cos_A+1)/sin(A),-w/2])
    rotate([-A,0,0])
    rotate([0,0,90])
    translate([0,0,-thickness])
    big_arc();
}

module small_side()
{
    translate([r-h,-(w/2)*(cos_A-1)/sin(A),w/2])
    rotate([0,0,90])
    translate([0,0,-thickness])
    small_arc();
}

module arc()
{
    joint();

    subdiv_arc(alpha/2/subdivisions, subdivisions-1)subdiv();

    rotate([-A,0,0])
    subdiv_arc(alpha/2/subdivisions, subdivisions-1)subdiv();

    big_side();
    small_side();
}




/*
* alpha = 2*beta
* cos (alpha) = 1 / (1-cos(A)) - 1
* cos (beta)  = (phi + 1) / (1+cos(A)) - 1
*
* let x = cos(A)
*
* 1 / (1-x) -1 = 2 * ( (phi + 1)/(1+x) - 1 )^2 - 1
*
* x^3+(-2*phi-1/2)x^2+(3*phi+2)x + (-phi-1/2) = 0
*/

phi=(1+sqrt(5))/2;
cuberoot=pow(118*phi+85+6*sqrt(1173*phi+729), 1/3);
cos_A=(1/6)*(4*phi+1) +
      (1/6)*(12*phi+7)/cuberoot -
      (1/6)*cuberoot;

A=acos(cos_A);

cos_alpha=1/(1-cos_A)-1;
alpha=acos(cos_alpha);

module step_x()
{
   rotate([0,0,alpha/2])rotate([A,0,0])
   children();
}

module step_y()
{
   rotate([0,0,3*alpha/2])rotate([180,0,0])
   children();
}

module penta()
{
   children();
   step_x(){
	   children();
	   step_x(){
		   children();
		   step_x(){
			   children();
			   step_x(){
				   children();
			   }
		   }
	   }
   }
}

module extend()
{
   children();
   step_y()step_x()step_x()step_x()
   {
	   penta()children();
	   step_y(){
		   penta()children();
		   step_x()step_x()step_y()children();
	   }
   }
}

module top_joint ()
{
	linear_extrude(thickness) polygon([[-43.11421341813179, -17.0],[-43.11421341813178, 17.0],[-40.11421341813178, 17.0],[-40.11421341813178, 20.0],[-16.41232297632699, 20.0],[-16.41232297632699, 17.0],[-13.41232297632699, 17.0],[-13.412322976326989, 20.0],[-10.636835166895432, 18.861286945847716],[-9.498122112743149, 21.636774755279273],[-12.273609922174705, 22.775487809431556],[-3.2770592374512546, 44.70359047000207],[-0.5015714280196981, 43.564877415849786],[0.6371416261325857, 46.34036522528134],[32.09267013302355, 33.43495061155545],[30.953957078871273, 30.6594628021239],[33.72944488830283, 29.520749747971617],[30.96203304920517, 22.775487809431556],[28.186545239773615, 23.91420086358384],[27.04783218562133, 21.138713054152284],[29.823319995052888, 20.0],[29.823319995052888, 17.0],[32.823319995052884, 17.0],[32.823319995052884, 20.0],[40.11421341813178, 20.0],[40.11421341813178, 17.0],[43.11421341813179, 17.0],[43.11421341813178, -17.0],[40.11421341813178, -17.0],[40.11421341813178, -20.0],[-40.11421341813178, -20.0],[-40.11421341813178, -17.0]],[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]]);
}
module mid_joint ()
{
	linear_extrude(thickness) polygon([[-41.43810665327744, -17.0],[-41.43810665327744, 17.0],[-36.93810665327744, 17.0],[-36.93810665327744, 20.0],[-32.43810665327744, 20.0],[-32.43810665327744, 17.0],[-22.41232297632699, 17.0],[-22.41232297632699, 20.0],[-17.91232297632699, 20.0],[-17.91232297632699, 17.0],[-13.41232297632699, 17.0],[-13.412322976326989, 20.0],[-10.636835166895432, 18.861286945847716],[-8.928765585667007, 23.024518659995053],[-11.704253395098563, 24.163231714147337],[-9.99618381387014, 28.32646342829467],[-7.220696004438583, 27.187750374142386],[-3.415199087421798, 36.463230499267006],[-6.190686896853355, 37.60194355341929],[-4.48261731562493, 41.76517526756662],[-1.7071295061933736, 40.626462213414335],[0.0009400750350510023, 44.78969392756167],[31.45646858192602, 31.88427931383579],[28.755901766849757, 25.30194476829962],[31.531389576281313, 24.163231714147337],[29.823319995052888, 20.0],[34.323319995052884, 20.0],[34.323319995052884, 17.0],[41.43810665327744, 17.0],[41.43810665327744, -17.0],[36.93810665327744, -17.0],[36.93810665327744, -20.0],[32.43810665327744, -20.0],[32.43810665327744, -17.0],[-32.43810665327744, -17.0],[-32.43810665327744, -20.0],[-36.93810665327744, -20.0],[-36.93810665327744, -17.0]],[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]]);
}
module bottom_joint ()
{
	linear_extrude(thickness) polygon([[37.06674657294206, -17.0],[37.06674657294206, -20.0],[-37.06674657294206, -20.0],[-37.06674657294206, -17.0],[-40.06674657294206, -17.0],[-40.06674657294206, 17.0],[-37.06674657294206, 17.0],[-37.06674657294206, 20.0],[-32.823319995052884, 20.0],[-32.823319995052884, 17.0],[-29.823319995052888, 17.0],[-29.823319995052888, 20.0],[-27.04783218562133, 21.138713054152284],[-28.186545239773615, 23.91420086358384],[-30.96203304920517, 22.775487809431556],[-32.57271479539822, 26.701347388481313],[-29.797226985966663, 27.840060442633597],[-30.935940040118947, 30.615548252065153],[0.5195884667720212, 43.520962865791034],[1.6583015209243044, 40.745475056359474],[4.433789330355861, 41.88418811051176],[12.273609922174705, 22.775487809431556],[9.498122112743149, 21.636774755279273],[10.636835166895432, 18.861286945847716],[13.412322976326989, 20.0],[13.41232297632699, 17.0],[16.41232297632699, 17.0],[16.41232297632699, 20.0],[37.06674657294206, 20.0],[37.06674657294206, 17.0],[40.06674657294206, 17.0],[40.06674657294206, -17.0]],[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]]);
}
module top_div ()
{
	linear_extrude(thickness) polygon([[-43.11421341813179, -17.0],[-43.11421341813178, 17.0],[-40.11421341813178, 17.0],[-40.11421341813178, 20.0],[40.11421341813178, 20.0],[40.11421341813178, 17.0],[43.11421341813179, 17.0],[43.11421341813178, -17.0],[40.11421341813178, -17.0],[40.11421341813178, -20.0],[-40.11421341813178, -20.0],[-40.11421341813178, -17.0]],[[0,1,2,3,4,5,6,7,8,9,10,11]]);
}
module mid_div ()
{
	linear_extrude(thickness) polygon([[-41.43810665327744, -17.0],[-41.43810665327744, 17.0],[-36.93810665327744, 17.0],[-36.93810665327744, 20.0],[-32.43810665327744, 20.0],[-32.43810665327744, 17.0],[32.43810665327744, 17.0],[32.43810665327744, 20.0],[36.93810665327744, 20.0],[36.93810665327744, 17.0],[41.43810665327744, 17.0],[41.43810665327744, -17.0],[36.93810665327744, -17.0],[36.93810665327744, -20.0],[32.43810665327744, -20.0],[32.43810665327744, -17.0],[-32.43810665327744, -17.0],[-32.43810665327744, -20.0],[-36.93810665327744, -20.0],[-36.93810665327744, -17.0]],[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]]);
}
module bottom_div ()
{
	linear_extrude(thickness) polygon([[37.06674657294206, -17.0],[37.06674657294206, -20.0],[-37.06674657294206, -20.0],[-37.06674657294206, -17.0],[-40.06674657294206, -17.0],[-40.06674657294206, 17.0],[-37.06674657294206, 17.0],[-37.06674657294206, 20.0],[37.06674657294206, 20.0],[37.06674657294206, 17.0],[40.06674657294206, 17.0],[40.06674657294206, -17.0]],[[0,1,2,3,4,5,6,7,8,9,10,11]]);
}
module big_arc ()
{
	linear_extrude(thickness) polygon([[0, 0],[3.0, -0.0],[3.0, -3.0],[7.243426577889174, -3.0],[7.243426577889174, -0.0],[10.243426577889174, -0.0],[13.2088011051429, 0.4544820272736265],[13.663283132416527, -2.5108924999800992],[86.94114052946429, 8.719887584625532],[86.48665850219066, 11.685262111879258],[89.45203302944441, 12.139744139152885],[92.31433042070124, 13.038217090334115],[93.21280337188247, 10.175919699077278],[163.94350471728936, 32.378232488462594],[163.04503176610814, 35.24052987971943],[165.90732915736498, 36.139002830900665],[168.6004771457498, 37.460726672199904],[169.92220098704905, 34.76757868381509],[236.47302363297484, 67.42891379371801],[235.1512997916756, 70.12206178210283],[237.84444778006042, 71.44378562340206],[240.30627868405756, 73.15825014625597],[242.02074320691148, 70.69641924225884],[302.85545135617707, 113.06283389354276],[301.14098683332315, 115.52466479753988],[303.60281773732027, 117.2391293203938],[305.77650351768153, 119.30675842839536],[307.8441326256831, 117.1330726480341],[361.5584392589218, 168.2265954167888],[359.49081015092025, 170.40028119715004],[361.6644959312815, 172.46791030515158],[363.499859989509, 174.84097557474846],[365.87292525910584, 173.00561151652101],[368.46900280070076, 176.3622542618787],[366.0959375311039, 178.19761832010613],[367.9313015893314, 180.570683589703],[382.1696932069126, 169.55849924033828],[379.4166471195714, 165.99890133594297],[381.78971238916824, 164.1635372777155],[384.54275847650945, 167.7231351821108],[401.9452371202198, 154.26379875510946],[400.10987306199235, 151.8907334855126],[397.7368077923955, 153.72609754374008],[393.2763265453668, 147.95884222152648],[395.6493918149637, 146.123478163299],[393.6741974788287, 143.56961695043796],[391.3349058147797, 141.3444620635668],[389.26727670677815, 143.51814784392803],[331.1368131751986, 88.22393763865074],[333.20444228320014, 86.0502518582895],[330.8651506191511, 83.82509697141833],[328.21576101369413, 81.98001310379814],[326.5012964908402, 84.44184400779527],[260.66502296931145, 38.592246829410456],[262.37948749216537, 36.13041592541333],[259.7300978867084, 34.28533205779314],[256.83176791822876, 32.8629104768725],[255.51004407692952, 35.556058465257316],[183.487701961809, 0.20945029878355914],[184.80942580310824, -2.4836976896012573],[181.9110958346286, -3.9061192705218986],[178.83072953334857, -4.873043884953741],[177.93225658216735, -2.010746493696905],[101.38638430280828, -26.03843696976527],[102.28485725398951, -28.90073436102211],[99.20449095270948, -29.867658975453953],[96.01319441157136, -30.356766475473854],[95.55871238429773, -27.39139194822013],[16.256267950332685, -39.54551797272644],[16.710749977606312, -42.51089249998016],[13.519453436468183, -43.00000000000006],[10.290893423078955, -43.00000000000006],[10.290893423078955, -40.00000000000006],[3.0000000000000604, -40.00000000000006],[3.0000000000000604, -43.00000000000006],[6.039613253960852e-14, -43.00000000000006],[5.635479810242225e-14, -21.000000000000057],[4.500000000000056, -21.000000000000057],[4.500000000000055, -18.000000000000057],[5.5067062021407764e-14, -18.000000000000057],[20.965392267259354, -19.601928445432847],[20.510910239985726, -16.63655391817912],[16.062848449105136, -17.31827695908956],[16.517330476378763, -20.283651486343285],[89.5408775127856, -9.091847756055984],[89.08639548551197, -6.126473228802258],[84.63833369463138, -6.808196269712697],[85.09281572190501, -9.773570796966423],[103.0198224013443, -5.611628725604967],[102.12134945016307, -2.7493313343481303],[97.82790336327781, -4.097040761119974],[98.72637631445905, -6.9593381523768105],[169.2116071888876, 15.165921644834649],[168.31313423770638, 18.028219036091485],[164.0196881508211, 16.680509609319643],[164.91816110200233, 13.818212218062806],[182.0077481310453, 20.64795199837623],[180.68602428974606, 23.341099986761044],[176.64630230716884, 21.358514224812186],[177.96802614846808, 18.66536623642737],[244.28788456714668, 51.213350380487924],[242.96616072584743, 53.90649836887274],[238.92643874327024, 51.923912606923885],[240.24816258456949, 49.23076461853907],[256.10583994327, 58.5706467953862],[254.39137542041607, 61.03247769938333],[250.69862906442037, 58.46078091510247],[252.4130935872743, 55.99895001110534],[313.03667525006114, 98.21833227673076],[311.3222107272072, 100.68016318072789],[307.62946437121155, 98.10846639644703],[309.34392889406547, 95.6466354924499],[323.60364353228823, 107.28106150865219],[321.5360144242867, 109.45474728901343],[318.2754857537448, 106.35330362701109],[320.34311486174636, 104.17961784664985],[373.8710063188772, 155.09582085383815],[371.8033772108757, 157.2695066341994],[368.5428485403338, 154.16806297219705],[370.61047764833535, 151.9943771918358]],[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79],[80,81,82,83],[84,85,86,87],[88,89,90,91],[92,93,94,95],[96,97,98,99],[100,101,102,103],[104,105,106,107],[108,109,110,111],[112,113,114,115],[116,117,118,119]]);
}
module small_arc ()
{
	linear_extrude(thickness) polygon([[0, 0],[3.0, -0.0],[3.0, -3.0],[23.65442359661507, -3.0],[23.65442359661507, -0.0],[26.65442359661507, -0.0],[29.619798123868797, 0.4544820272736263],[30.074280151142425, -2.5108924999800983],[103.35213754819021, 8.719887584625532],[102.89765552091659, 11.685262111879258],[105.86303004817032, 12.139744139152885],[108.72532743942715, 13.038217090334115],[109.62380039060838, 10.175919699077278],[180.3545017360153, 32.378232488462594],[179.45602878483407, 35.24052987971943],[182.3183261760909, 36.139002830900665],[185.01147416447571, 37.460726672199904],[186.33319800577496, 34.76757868381509],[204.87500445926554, 43.86739338246166],[203.5532806179663, 46.56054137084647],[206.24642860635112, 47.88226521214571],[225.1911369983069, 9.28047737863001],[222.49798900992207, 7.958753537330772],[221.17626516862282, 10.651901525715587],[199.89869898053487, 0.20945029878360177],[201.22042282183412, -2.4836976896012146],[198.3220928533545, -3.9061192705218577],[195.24172655207445, -4.873043884953701],[194.34325360089323, -2.010746493696865],[117.79738132153416, -26.038436969765236],[118.6958542727154, -28.900734361022074],[115.61548797143536, -29.867658975453914],[112.42419143029724, -30.356766475473815],[111.96970940302361, -27.39139194822009],[32.667264969058564, -39.545517972726394],[33.12174699633219, -42.510892499980116],[29.930450455194062, -43.000000000000014],[26.701890441804835, -43.000000000000014],[26.701890441804835, -40.000000000000014],[3.0000000000000417, -40.00000000000002],[3.0000000000000426, -43.00000000000002],[4.263256414560601e-14, -43.00000000000002],[9.0, -21.0],[9.0, -18.0],[4.5, -18.0],[4.5, -21.0],[23.525783676950446, -21.0],[23.525783676950446, -18.0],[19.025783676950446, -18.0],[19.025783676950446, -21.0],[37.37638928598525, -19.601928445432847],[36.92190725871162, -16.63655391817912],[32.47384546783103, -17.31827695908956],[32.92832749510466, -20.283651486343285],[105.95187453151149, -9.091847756055984],[105.49739250423787, -6.126473228802258],[101.04933071335728, -6.808196269712697],[101.5038127406309, -9.773570796966423],[119.4308194200702, -5.611628725604967],[118.53234646888896, -2.7493313343481303],[114.2389003820037, -4.097040761119974],[115.13737333318494, -6.9593381523768105],[185.62260420761348, 15.165921644834649],[184.72413125643226, 18.028219036091485],[180.430685169547, 16.680509609319643],[181.3291581207282, 13.818212218062806],[198.41874514977118, 20.64795199837623],[197.09702130847194, 23.341099986761044],[193.05729932589472, 21.358514224812186],[194.37902316719396, 18.66536623642737],[211.45877351286856, 27.047643531503137],[210.13704967156932, 29.740791519887953],[206.0973276889921, 27.758205757939095],[207.41905153029134, 25.06505776955428]],[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41],[42,43,44,45],[46,47,48,49],[50,51,52,53],[54,55,56,57],[58,59,60,61],[62,63,64,65],[66,67,68,69],[70,71,72,73]]);
}
penta()extend()arc();
